5c5
< !     c                 July, 2002               c
---
> !     c                 July, 2002                           c
21d20
< 
31c30
<     fh,scalarIter,test_u,test_s,tstat, &
---
>     fh,scalarIter,test_u,test_s,tstat,NNz, &
50c49
<     obukovUnits,scalarStarUnits,rogue_flag
---
>     obukovUnits,scalarStarUnits, rogue_flag
58,61c57,60
<     atzz,atxy,e,aCs2,aCs,adwdz,adwdx,abeta1,advdz,aESGS,aDSGS, &
<     aTL,specu,specv,specw,specp,release_pos,temp,albedo, &
<     minAlbedo,soilHeatFlux,obukhovL,u_hat,v_hat,tempFrameA2, &
<     particle_tmp
---
>     atzz,atxy,e,aCs2,aCs,adwdz,adwdx,abeta1,advdz,aESGS,aDSGS,specu, &
>     specv,specw,specp,release_pos,temp,albedo,minAlbedo, &
>     soilHeatFlux,obukhovL,u_hat,v_hat,tempFrameA2, &
>     particle_tmp,xz_bar, aTL
74,75c73,74
<     heatCapSoil,scalar_hat,particle,TL,us_f,ESGS_f,lambda2
<           
---
>     heatCapSoil,scalar_hat,particle,TL,us_f,ESGS_f, lambda2
> 
82c81,83
<     character(50) :: frameStr
---
>     character(50) :: frameStr, fileStr21, fileStr22, fileStr23, fileStr24
>     character(50) :: fileStr25, fileStr31, fileStr32, fileStr33, fileStr34
>     character(50) :: fileStr35
116c117
<      
---
> 
130,131c131,132
<     aDSGS(anx,nz2),aTL(anx,nz2),specu(Nx/2+1,nz2), &
<     specv(Nx/2+1,nz2),specw(Nx/2+1,nz2),specp(Nx/2+1,nz2))
---
>     specu(Nx/2+1,nz2),specv(Nx/2+1,nz2),specw(Nx/2+1,nz2), &
>     specp(Nx/2+1,nz2),xz_bar(nx,nz2), aDSGS(anx, nz2), aTL(anx, nz2))
149c150
<     TL(nx,nyb,nz2),lambda2(nx,nyb,nz2))
---
>     TL(nx,nyb,nz2),lambda2(nx, nyb, nz2))
154,155c155,156
< 
<     if(vfact == 0 .AND. verticalBC == 0)then  !Only bottom procs need allocate surface variables
---
> ! nly bottom procs need allocate surface variables
>     if(vfact == 0 .AND. verticalBC == 0)then
228c229
<     IF(npart > 0)THEN
---
>    IF(npart > 0)THEN
276c277
< ! cccc  File unit variables     ccccc
---
> ! cccc  File unit variables                     ccccc
278c279
< ! ***** initialize unit array variables for scalar files
---
> !       ***** initialize unit array variables for scalar files
286,305c287,306
<         dsdxUnits(l+1)      = 680 + l
<         dsdyUnits(l+1)      = 690 + l
<         dsdzUnits(l+1)      = 700 + l
<         scalarMeanUnits(l+1)    = 710 + l
<         scalar2Units(l+1)     = 720 + l
<         scalar3Units(l+1)     = 730 + l
<         xScalarFluxUnits(l+1)   = 740 + l
<         yScalarFluxUnits(l+1)   = 750 + l
<         zScalarFluxUnits(l+1)   = 760 + l
<         awsUnits(l+1)     = 770 + l
<         ausUnits(l+1)     = 780 + l
<         avsUnits(l+1)     = 790 + l
<         scalarSpectraUnits(l+1)   = 800 + l
<         scalarPrandtlUnits(l+1)   = 810 + l
<         cs2prUnits(l+1)     = 820 + l
<         beta2Units(l+1)     = 830 + l
<         ETUnits(l+1)      = 840 + l
<         obukovUnits(l+1)      = 850 + l
<         scalarStarUnits(l+1)    = 860 + l
<         surfaceFluxUnits(l+1)   = 870 + l
---
>         dsdxUnits(l+1)                      = 680 + l
>         dsdyUnits(l+1)                      = 690 + l
>         dsdzUnits(l+1)                      = 700 + l
>         scalarMeanUnits(l+1)                = 710 + l
>         scalar2Units(l+1)                   = 720 + l
>         scalar3Units(l+1)                   = 730 + l
>         xScalarFluxUnits(l+1)               = 740 + l
>         yScalarFluxUnits(l+1)               = 750 + l
>         zScalarFluxUnits(l+1)               = 760 + l
>         awsUnits(l+1)                       = 770 + l
>         ausUnits(l+1)                       = 780 + l
>         avsUnits(l+1)                       = 790 + l
>         scalarSpectraUnits(l+1)             = 800 + l
>         scalarPrandtlUnits(l+1)             = 810 + l
>         cs2prUnits(l+1)                     = 820 + l
>         beta2Units(l+1)                     = 830 + l
>         ETUnits(l+1)                        = 840 + l
>         obukovUnits(l+1)                    = 850 + l
>         scalarStarUnits(l+1)                = 860 + l
>         surfaceFluxUnits(l+1)               = 870 + l
330c331
< ! omentum
---
> ! momentum
342c343
< ! oil
---
> ! soil
357c358
<                  
---
> 
373,390c374,375
<         call MPI_FILE_OPEN(nall,'input/vel.ini', &
<         MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
<         view_disp=0
<         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<         fileview_3D,"native",MPI_INFO_NULL,ierr)
<         call MPI_FILE_READ_ALL(fh,u(1,1,2), &
<         Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<         fileview_3D,"native",MPI_INFO_NULL,ierr)
<         call MPI_FILE_READ_ALL(fh,v(1,1,2), &
<         Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=2*8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<         fileview_3D,"native",MPI_INFO_NULL,ierr)
<         call MPI_FILE_READ_ALL(fh,w(1,1,2), &
<         Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         call MPI_FILE_CLOSE(fh,ierr)
---
>     ! cc  Read INITIAL u,v,w Velocity Fields
> 
391a377,380
>         if(me == 0)write(*,*)'start reading u,v,w'
>         call read3D(u,1,1,2,'input/u.ini',fileview_3D)
>         call read3D(v,1,1,2,'input/v.ini',fileview_3D)
>         call read3D(w,1,1,2,'input/w.ini',fileview_3D)
397c386
<                  
---
> 
404c393
<                         
---
> 
412d400
< 
415c403
<                         
---
> 
431,437c419,427
<             call MPI_FILE_OPEN(nall,'input/PlantDensity.ini', &
<             MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,LAD_uvp(1,1,2), &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<             call MPI_FILE_CLOSE(fh,ierr)
---
>             call read3D(LAD_uvp,1,1,2,'input/PlantDensity.ini',fileview_3D)
>         !         call MPI_FILE_OPEN(nall,'input/PlantDensity.ini',
>         !     +        MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
>         
>         !         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +        fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !         call MPI_FILE_READ_ALL(fh,LAD_uvp(1,1,2),
>         !     +        Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>         !         call MPI_FILE_CLOSE(fh,ierr)
479c469
<                 
---
> 
482,499c472
<         call MPI_FILE_OPEN(nall,'checkpoints/vel.break', &
<         MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
<         view_disp=0
<         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<         fileview_3D,"native",MPI_INFO_NULL,ierr)
<         call MPI_FILE_READ_ALL(fh,u(1,1,2), &
<         Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<         fileview_3D,"native",MPI_INFO_NULL,ierr)
<         call MPI_FILE_READ_ALL(fh,v(1,1,2), &
<         Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=2*8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<         fileview_3D,"native",MPI_INFO_NULL,ierr)
<         call MPI_FILE_READ_ALL(fh,w(1,1,2), &
<         Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         call MPI_FILE_CLOSE(fh,ierr)
---
> 
500a474,499
>         if(me == 0) write(*,*)'reading break files:'
>         call read3D(u,1,1,2,'checkpoints/u.break',fileview_3D)
>         call read3D(v,1,1,2,'checkpoints/v.break',fileview_3D)
>         call read3D(w,1,1,2,'checkpoints/w.break',fileview_3D)
>     !         if(me.eq.0) write(*, *) 'shape(P)', shape(P)
> 
> 
>     !         call MPI_FILE_OPEN(nall,'checkpoints/vel.break',
>     !     +        MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
>     !         view_disp=0
>     !         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>     !     +        fileview_3D,"native",MPI_INFO_NULL,ierr)
>     !         call MPI_FILE_READ_ALL(fh,u(1,1,2),
>     !    +        Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !         view_disp=8*Nx*Ny*Nz
>     !         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>     !     +        fileview_3D,"native",MPI_INFO_NULL,ierr)
>     !        call MPI_FILE_READ_ALL(fh,v(1,1,2),
>     !     +        Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !         view_disp=2*8*Nx*Ny*Nz
>     !         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>     !     +        fileview_3D,"native",MPI_INFO_NULL,ierr)
>     !         call MPI_FILE_READ_ALL(fh,w(1,1,2),
>     !     +        Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !         call MPI_FILE_CLOSE(fh,ierr)
>     !         view_disp=0
506c505
<                  
---
> 
513c512
<                         
---
> 
521c520
<                         
---
> 
537c536
<                 
---
> 
541,547c540,547
<             call MPI_FILE_OPEN(nall,'input/PlantDensity.ini', &
<             MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,LAD_uvp(1,1,2), &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<             call MPI_FILE_CLOSE(fh,ierr)
---
>             call read3D(LAD_uvp,1,1,2,'input/PlantDensity.ini',fileview_3D)
>         !         call MPI_FILE_OPEN(nall,'input/PlantDensity.ini',
>         !     +        MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
>         !         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +        fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !         call MPI_FILE_READ_ALL(fh,LAD_uvp(1,1,2),
>         !     +        Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>         !         call MPI_FILE_CLOSE(fh,ierr)
572c572
<                  
---
> 
574,592c574,598
<                  
<         call MPI_FILE_OPEN(nall,'checkpoints/RHS_mom.break', &
<         MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
<         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<         fileview_3D,"native",MPI_INFO_NULL,ierr)
<         call MPI_FILE_READ_ALL(fh,RHSx(1,1,2), &
<         Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<         fileview_3D,"native",MPI_INFO_NULL,ierr)
<         call MPI_FILE_READ_ALL(fh,RHSy(1,1,2), &
<         Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=2*8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<         fileview_3D,"native",MPI_INFO_NULL,ierr)
<         call MPI_FILE_READ_ALL(fh,RHSz(1,1,2), &
<         Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         call MPI_FILE_CLOSE(fh,ierr)
<         view_disp=0
---
>         call read3D(RHSx,1,1,2,'checkpoints/RHS_momX.break', &
>         fileview_3D)
>         call read3D(RHSy,1,1,2,'checkpoints/RHS_momY.break', &
>         fileview_3D)
>         call read3D(RHSz,1,1,2,'checkpoints/RHS_momZ.break', &
>         fileview_3D)
> 
>     !         call MPI_FILE_OPEN(nall,'checkpoints/RHS_mom.break',
>     !     +     MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
>     !         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>     !     +        fileview_3D,"native",MPI_INFO_NULL,ierr)
>     !        call MPI_FILE_READ_ALL(fh,RHSx(1,1,2),
>     !     +        Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !         view_disp=8*Nx*Ny*Nz
>     !         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>     !     +        fileview_3D,"native",MPI_INFO_NULL,ierr)
>     !         call MPI_FILE_READ_ALL(fh,RHSy(1,1,2),
>     !     +        Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !         view_disp=2*8*Nx*Ny*Nz
>     !         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>     !     +        fileview_3D,"native",MPI_INFO_NULL,ierr)
>     !         call MPI_FILE_READ_ALL(fh,RHSz(1,1,2),
>     !     +        Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !         call MPI_FILE_CLOSE(fh,ierr)
>     !         view_disp=0
597,613c603,624
<             call MPI_FILE_OPEN(nall,'checkpoints/a1_e1.break', &
<             MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,tmp_old, &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE, &
<             ierr)
<             a1_old(:,2:nyb+1,2:nzb+1)=tmp_old
<             view_disp=8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,tmp_old, &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE, &
<             ierr)
<             b1_old(:,2:nyb+1,2:nzb+1)=tmp_old
<             call MPI_FILE_CLOSE(fh,ierr)
<             view_disp=0
---
>             call read3D(a1_old,1,1,2,'checkpoints/a1.break', &
>             fileview_3D)
>             call read3D(b1_old,1,1,2,'checkpoints/b1.break', &
>             fileview_3D)
> 
>         !             call MPI_FILE_OPEN(nall,'checkpoints/a1_e1.break',
>         !     +            MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
>         !             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +            fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !             call MPI_FILE_READ_ALL(fh,tmp_old,
>         !     +            Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,
>         !     +            ierr)
>         !             a1_old(:,2:nyb+1,2:nzb+1)=tmp_old
>         !             view_disp=8*Nx*Ny*Nz
>         !             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +            fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !             call MPI_FILE_READ_ALL(fh,tmp_old,
>         !     +            Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,
>         !     +            ierr)
>         !             b1_old(:,2:nyb+1,2:nzb+1)=tmp_old
>         !             call MPI_FILE_CLOSE(fh,ierr)
>         !             view_disp=0
616,655c627
<         ! cc      Read BREAK a1_old-e1_old and a2_old-e2_old
< 
<             call MPI_FILE_OPEN(nall,'checkpoints/a1_e1.break', &
<             MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,tmp_old, &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE, &
<             ierr)
<             a1_old(:,2:nyb+1,2:nzb+1)=tmp_old
<             view_disp=8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,tmp_old, &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE, &
<             ierr)
<             b1_old(:,2:nyb+1,2:nzb+1)=tmp_old
<             view_disp=2*8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,tmp_old, &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE, &
<             ierr)
<             c1_old(:,2:nyb+1,2:nzb+1)=tmp_old
<             view_disp=3*8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,tmp_old, &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE, &
<             ierr)
<             d1_old(:,2:nyb+1,2:nzb+1)=tmp_old
<             view_disp=4*8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,tmp_old, &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE, &
<             ierr)
<             e1_old(:,2:nyb+1,2:nzb+1)=tmp_old
<             call MPI_FILE_CLOSE(fh,ierr)
<             view_disp=0
---
>         !!      Read BREAK a1_old-e1_old and a2_old-e2_old
657,694c629,726
<             call MPI_FILE_OPEN(nall,'checkpoints/a2_e2.break', &
<             MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,tmp_old, &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE, &
<             ierr)
<             a2_old(:,2:nyb+1,2:nzb+1)=tmp_old
<             view_disp=8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,tmp_old, &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE, &
<             ierr)
<             b2_old(:,2:nyb+1,2:nzb+1)=tmp_old
<             view_disp=2*8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,tmp_old, &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE, &
<             ierr)
<             c2_old(:,2:nyb+1,2:nzb+1)=tmp_old
<             view_disp=3*8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,tmp_old, &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE, &
<             ierr)
<             d2_old(:,2:nyb+1,2:nzb+1)=tmp_old
<             view_disp=4*8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_READ_ALL(fh,tmp_old, &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE, &
<             ierr)
<             e2_old(:,2:nyb+1,2:nzb+1)=tmp_old
<             call MPI_FILE_CLOSE(fh,ierr)
<             view_disp=0
---
>             call read3D(a1_old,1,1,2,'checkpoints/a1.break', &
>             fileview_3D)
>             call read3D(b1_old,1,1,2,'checkpoints/b1.break', &
>             fileview_3D)
>             call read3D(c1_old,1,1,2,'checkpoints/c1.break', &
>             fileview_3D)
>             call read3D(d1_old,1,1,2,'checkpoints/d1.break', &
>             fileview_3D)
>             call read3D(e1_old,1,1,2,'checkpoints/e1.break', &
>             fileview_3D)
> 
>             call read3D(a2_old,1,1,2,'checkpoints/a2.break', &
>             fileview_3D)
>             call read3D(b2_old,1,1,2,'checkpoints/b2.break', &
>             fileview_3D)
>             call read3D(c2_old,1,1,2,'checkpoints/c2.break', &
>             fileview_3D)
>             call read3D(d2_old,1,1,2,'checkpoints/d2.break', &
>             fileview_3D)
>             call read3D(e2_old,1,1,2,'checkpoints/e2.break', &
>             fileview_3D)
>         !             call MPI_FILE_OPEN(nall,'checkpoints/a1_e1.break',
>         !     +            MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
>         !             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +            fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !             call MPI_FILE_READ_ALL(fh,tmp_old,
>         !     +            Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,
>         !     +            ierr)
>         !             a1_old(:,2:nyb+1,2:nzb+1)=tmp_old
>         !             view_disp=8*Nx*Ny*Nz
>         !             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +            fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !            call MPI_FILE_READ_ALL(fh,tmp_old,
>         !     +            Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,
>         !     +            ierr)
>         !             b1_old(:,2:nyb+1,2:nzb+1)=tmp_old
>         !             view_disp=2*8*Nx*Ny*Nz
>         !             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +            fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !             call MPI_FILE_READ_ALL(fh,tmp_old,
>         !     +            Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,
>         !     +            ierr)
>         !             c1_old(:,2:nyb+1,2:nzb+1)=tmp_old
>         !             view_disp=3*8*Nx*Ny*Nz
>         !             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +            fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !             call MPI_FILE_READ_ALL(fh,tmp_old,
>         !     +            Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,
>         !     +            ierr)
>         !             d1_old(:,2:nyb+1,2:nzb+1)=tmp_old
>         !             view_disp=4*8*Nx*Ny*Nz
>         !             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +            fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !             call MPI_FILE_READ_ALL(fh,tmp_old,
>         !     +            Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,
>         !     +            ierr)
>         !             e1_old(:,2:nyb+1,2:nzb+1)=tmp_old
>         !             call MPI_FILE_CLOSE(fh,ierr)
>         !            view_disp=0
>         
>         !             call MPI_FILE_OPEN(nall,'checkpoints/a2_e2.break',
>         !     +            MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
>         !             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +            fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !             call MPI_FILE_READ_ALL(fh,tmp_old,
>         !     +            Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,
>         !     +            ierr)
>         !             a2_old(:,2:nyb+1,2:nzb+1)=tmp_old
>         !             view_disp=8*Nx*Ny*Nz
>         !             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +            fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !             call MPI_FILE_READ_ALL(fh,tmp_old,
>         !     +            Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,
>         !     +            ierr)
>         !             b2_old(:,2:nyb+1,2:nzb+1)=tmp_old
>         !             view_disp=2*8*Nx*Ny*Nz
>         !             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +            fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !             call MPI_FILE_READ_ALL(fh,tmp_old,
>         !     +            Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,
>         !     +            ierr)
>         !             c2_old(:,2:nyb+1,2:nzb+1)=tmp_old
>         !             view_disp=3*8*Nx*Ny*Nz
>         !             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +            fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !             call MPI_FILE_READ_ALL(fh,tmp_old,
>         !     +            Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,
>         !     +            ierr)
>         !             d2_old(:,2:nyb+1,2:nzb+1)=tmp_old
>         !             view_disp=4*8*Nx*Ny*Nz
>         !             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>         !     +            fileview_3D,"native",MPI_INFO_NULL,ierr)
>         !             call MPI_FILE_READ_ALL(fh,tmp_old,
>         !     +            Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,
>         !     +            ierr)
>         !             e2_old(:,2:nyb+1,2:nzb+1)=tmp_old
>         !             call MPI_FILE_CLOSE(fh,ierr)
>         !             view_disp=0
723c755
<              
---
> 
736,738d767
<                 view_disp=0
<                 call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION &
<                 ,fileview_3D,"native",MPI_INFO_NULL,ierr)
743c772
<                          
---
> 
745c774
<                               
---
> 
750c779
<                  
---
> 
755,771c784,814
<                 if(inits == 0)then
<                     write(fileStr1, '(A)') 'input/temperature.ini'
<                     write(fileStr5, '(A)')'input/coolrate.ini'
<                     write(fileStr6, '(A)') &
<                     'input/surfaceTemperature.ini'
<                 elseif(inits == 1)then
<                     write(fileStr1, '(A)')'checkpoints/temperature.break'
<                     write(fileStr2, '(A)') &
<                     'checkpoints/a4_e4_temperature.break'
<                     write(fileStr3, '(A)') &
<                     'checkpoints/a8_e8_temperature.break'
<                     write(fileStr4, '(A)') &
<                     'checkpoints/RHS_temperature.break'
<                     write(fileStr5, '(A)')'checkpoints/coolrate.break'
<                     write(fileStr6, '(A)') &
<                     'checkpoints/surfaceTemperature.break'
<                 endif
---
>                 write(fileStr1, '(A)') &
>                 'checkpoints/temperature.break'
>                 write(fileStr2, '(A)') &
>                 'checkpoints/a4_e4_temperature.break'
>                 write(fileStr21, '(A)') &
>                 'checkpoints/a4_temperature.break'
>                 write(fileStr22, '(A)') &
>                 'checkpoints/b4_temperature.break'
>                 write(fileStr23, '(A)') &
>                 'checkpoints/c4_temperature.break'
>                 write(fileStr24, '(A)') &
>                 'checkpoints/d4_temperature.break'
>                 write(fileStr25, '(A)') &
>                 'checkpoints/e4_temperature.break'
>                 write(fileStr3, '(A)') &
>                 'checkpoints/a8_e8_temperature.break'
>                 write(fileStr31, '(A)') &
>                 'checkpoints/a8_temperature.break'
>                 write(fileStr32, '(A)') &
>                 'checkpoints/b8_temperature.break'
>                 write(fileStr33, '(A)') &
>                 'checkpoints/c8_temperature.break'
>                 write(fileStr34, '(A)') &
>                 'checkpoints/d8_temperature.break'
>                 write(fileStr35, '(A)') &
>                 'checkpoints/e8_temperature.break'
>                 write(fileStr4, '(A)') &
>                 'checkpoints/RHS_temperature.break'
>                 write(fileStr5, '(A)')'checkpoints/coolrate.break'
>                 write(fileStr6, '(A)') &
>                 'checkpoints/surfaceTemperature.break'
773,792c816,847
<                 if(inits == 0)then
<                     write(fileStr1, '(A)') 'input/moisture.ini'
<                     write(fileStr5, '(A)')'input/dsdt_Moisture.ini'
<                     write(fileStr6, '(A)') &
<                     'input/surfaceMoisture.ini'
<                 elseif(inits == 1)then
<                     write(fileStr1, '(A)') &
<                     'checkpoints/moisture.break'
<                     write(fileStr2, '(A)') &
<                     'checkpoints/a4_e4_moisture.break'
<                     write(fileStr3, '(A)') &
<                     'checkpoints/a8_e8_moisture.break'
<                     write(fileStr4, '(A)') &
<                     'checkpoints/RHS_moisture.break'
<                     write(fileStr5, '(A)') &
<                     'checkpoints/dsdt_Moisture.break'
<                     write(fileStr6, '(A)') &
<                     'checkpoints/surfaceMoisture.break'
<                 endif
<             else               ! scalar is passive
---
>                 write(fileStr1, '(A)')'checkpoints/moisture.break'
>                 write(fileStr2, '(A)') &
>                 'checkpoints/a4_e4_moisture.break'
>                 write(fileStr21, '(A)') &
>                 'checkpoints/a4_moisture.break'
>                 write(fileStr22, '(A)') &
>                 'checkpoints/b4_moisture.break'
>                 write(fileStr23, '(A)') &
>                 'checkpoints/c4_moisture.break'
>                 write(fileStr24, '(A)') &
>                 'checkpoints/d4_moisture.break'
>                 write(fileStr25, '(A)') &
>                 'checkpoints/e4_moisture.break'
>                 write(fileStr3, '(A)') &
>                 'checkpoints/a8_e8_moisture.break'
>                 write(fileStr31, '(A)') &
>                 'checkpoints/a8_moisture.break'
>                 write(fileStr32, '(A)') &
>                 'checkpoints/b8_moisture.break'
>                 write(fileStr33, '(A)') &
>                 'checkpoints/c8_moisture.break'
>                 write(fileStr34, '(A)') &
>                 'checkpoints/d8_moisture.break'
>                 write(fileStr35, '(A)') &
>                 'checkpoints/e8_moisture.break'
>                 write(fileStr4, '(A)') &
>                 'checkpoints/RHS_moisture.break'
>                 write(fileStr5, '(A)') &
>                 'checkpoints/dsdt_Moisture.break'
>                 write(fileStr6, '(A)') &
>                 'checkpoints/surfaceMoisture.break'
>             else             ! = 0, scalar is passive
794,815c849,880
<                 if(inits == 0)then
<                     write(fileStr1, '(A,I1,A)') &
<                     'input/scalar',scalarIter,'.ini'
<                     write(fileStr5, '(A,I1,A)')'input/dsdt_scalar', &
<                     scalarIter,'.ini'
<                     write(fileStr6, '(A,I1,A)') &
<                     'input/surfaceScalar', &
<                     scalarIter,'.ini'
<                 elseif(inits == 1)then
<                     write(fileStr1, '(A,I1,A)') &
<                     'checkpoints/scalar',scalarIter,'.break'
<                     write(fileStr2, '(A,I1,A)') &
<                     'checkpoints/a4_e4_scalar',scalarIter,'.break'
<                     write(fileStr3, '(A,I1,A)') &
<                     'checkpoints/a8_e8_scalar',scalarIter,'.break'
<                     write(fileStr4, '(A,I1,A)') &
<                     'checkpoints/RHS_scalar',scalarIter,'.break'
<                     write(fileStr5, '(A,I1,A)') &
<                     'checkpoints/dsdt_scalar',scalarIter,'.break'
<                     write(fileStr6, '(A,I1,A)') &
<                     'checkpoints/surfaceScalar',scalarIter,'.break'
<                 endif
---
>                 write(fileStr1, '(A,I1,A)') &
>                 'checkpoints/scalar.break',scalarIter,'.break'
>                 write(fileStr2, '(A,I1,A)') &
>                 'checkpoints/a4_e4_scalar.break',scalarIter,'.break'
>                 write(fileStr21, '(A,I1,A)') &
>                 'checkpoints/a4_scalar.break',scalarIter,'.break'
>                 write(fileStr22, '(A,I1,A)') &
>                 'checkpoints/b4_scalar.break',scalarIter,'.break'
>                 write(fileStr23, '(A,I1,A)') &
>                 'checkpoints/c4_scalar.break',scalarIter,'.break'
>                 write(fileStr24, '(A,I1,A)') &
>                 'checkpoints/d4_scalar.break',scalarIter,'.break'
>                 write(fileStr25, '(A,I1,A)') &
>                 'checkpoints/e4_scalar.break',scalarIter,'.break'
>                 write(fileStr3, '(A,I1,A)') &
>                 'checkpoints/a8_e8_scalar.break',scalarIter,'.break'
>                 write(fileStr31, '(A,I1,A)') &
>                 'checkpoints/a8_scalar.break',scalarIter,'.break'
>                 write(fileStr32, '(A,I1,A)') &
>                 'checkpoints/b8_scalar.break',scalarIter,'.break'
>                 write(fileStr33, '(A,I1,A)') &
>                 'checkpoints/c8_scalar.break',scalarIter,'.break'
>                 write(fileStr34, '(A,I1,A)') &
>                 'checkpoints/d8_scalar.break',scalarIter,'.break'
>                 write(fileStr35, '(A,I1,A)') &
>                 'checkpoints/e8_scalar.break',scalarIter,'.break'
>                 write(fileStr4, '(A,I1,A)') &
>                 'checkpoints/RHS_scalar.break',scalarIter,'.break'
>                 write(fileStr5, '(A,I1,A)') &
>                 'checkpoints/dsdt_scalar.break',scalarIter,'.break'
>                 write(fileStr6, '(A,I1,A)') &
>                 'checkpoints/surfaceScalar',scalarIter,'.break'
841c906
<                                 
---
> 
853c918
<                                 
---
> 
857,864c922,930
<                     call MPI_FILE_OPEN(nall,filestr2, &
<                     MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
<                     call MPI_FILE_READ_ALL(fh,tmp_old, &
<                     Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<                     ,ierr)
---
>                 !                   call MPI_FILE_OPEN(nall,filestr2,
>                 !     +                  MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
>                 !                   call MPI_FILE_SET_VIEW(fh,view_disp,
>                 !     +                  MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                 !     +                  MPI_INFO_NULL,ierr)
>                 !                   call MPI_FILE_READ_ALL(fh,tmp_old,
>                 !     +                 Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE
>                 !     +                  ,ierr)
>                     call read3D(tmp_old,1,1,2,fileStr21,fileview_3D)
866,872c932,939
<                     view_disp=8*Nx*Ny*Nz
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
<                     call MPI_FILE_READ_ALL(fh,tmp_old, &
<                     Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<                     ,ierr)
---
>                 !                   view_disp=8*Nx*Ny*Nz
>                 !                   call MPI_FILE_SET_VIEW(fh,view_disp,
>                 !     +                  MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                 !     +                  MPI_INFO_NULL,ierr)
>                 !                   call MPI_FILE_READ_ALL(fh,tmp_old,
>                 !     +                 Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE
>                 !     +                  ,ierr)
>                     call read3D(tmp_old,1,1,2,fileStr22,fileview_3D)
874c941,942
<                     call MPI_FILE_CLOSE(fh,ierr)
---
>                 !                   call MPI_FILE_CLOSE(fh,ierr)
> 
876c944
<                                     
---
> 
879,887c947,956
<                                        
<                     call MPI_FILE_OPEN(nall,filestr2, &
<                     MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
<                     call MPI_FILE_READ_ALL(fh,tmp_old, &
<                     Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<                     ,ierr)
---
> 
>                 !                   call MPI_FILE_OPEN(nall,filestr2,
>                 !     +                  MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
>                 !                   call MPI_FILE_SET_VIEW(fh,view_disp,
>                 !     +                  MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                 !     +                  MPI_INFO_NULL,ierr)
>                 !                   call MPI_FILE_READ_ALL(fh,tmp_old,
>                 !     +                 Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE
>                 !     +                  ,ierr)
>                     call read3D(tmp_old,1,1,2,fileStr21,fileview_3D)
889,895c958,965
<                     view_disp=8*Nx*Ny*Nz
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
<                     call MPI_FILE_READ_ALL(fh,tmp_old, &
<                     Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<                     ,ierr)
---
>                 !                   view_disp=8*Nx*Ny*Nz
>                 !                   call MPI_FILE_SET_VIEW(fh,view_disp,
>                 !     +                  MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                 !     +                  MPI_INFO_NULL,ierr)
>                 !                   call MPI_FILE_READ_ALL(fh,tmp_old,
>                 !     +                 Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE
>                 !     +                  ,ierr)
>                     call read3D(tmp_old,1,1,2,fileStr22,fileview_3D)
897,903c967,975
<                     view_disp=2*8*Nx*Ny*Nz
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
<                     call MPI_FILE_READ_ALL(fh,tmp_old, &
<                     Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<                     ,ierr)
---
>                 !                   view_disp=2*8*Nx*Ny*Nz
> 
>                 !                   call MPI_FILE_SET_VIEW(fh,view_disp,
>                 !     +                  MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                 !     +                  MPI_INFO_NULL,ierr)
>                 !                   call MPI_FILE_READ_ALL(fh,tmp_old,
>                 !     +                 Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE
>                 !     +                  ,ierr)
>                     call read3D(tmp_old,1,1,2,fileStr23,fileview_3D)
905,911c977,985
<                     view_disp=3*8*Nx*Ny*Nz
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
<                     call MPI_FILE_READ_ALL(fh,tmp_old, &
<                     Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<                     ,ierr)
---
>                 !                   view_disp=3*8*Nx*Ny*Nz
> 
>                 !                   call MPI_FILE_SET_VIEW(fh,view_disp,
>                 !     +                  MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                 !     +                  MPI_INFO_NULL,ierr)
>                 !                   call MPI_FILE_READ_ALL(fh,tmp_old,
>                 !     +                 Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE
>                 !     +                  ,ierr)
>                     call read3D(tmp_old,1,1,2,fileStr24,fileview_3D)
913,919c987,995
<                     view_disp=4*8*Nx*Ny*Nz
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
<                     call MPI_FILE_READ_ALL(fh,tmp_old, &
<                     Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<                     ,ierr)
---
>                 !                   view_disp=4*8*Nx*Ny*Nz
> 
>                 !                   call MPI_FILE_SET_VIEW(fh,view_disp,
>                 !     +                  MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                 !     +                  MPI_INFO_NULL,ierr)
>                 !                   call MPI_FILE_READ_ALL(fh,tmp_old,
>                 !     +                 Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE
>                 !     +                  ,ierr)
>                     call read3D(tmp_old,1,1,2,fileStr25,fileview_3D)
921c997,998
<                     call MPI_FILE_CLOSE(fh,ierr)
---
>                 !                   call MPI_FILE_CLOSE(fh,ierr)
> 
924,931c1001,1009
<                     call MPI_FILE_OPEN(nall,filestr2, &
<                     MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
<                     call MPI_FILE_READ_ALL(fh,tmp_old, &
<                     Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<                     ,ierr)
---
>                 !                   call MPI_FILE_OPEN(nall,filestr2,
>                 !     +                  MPI_MODE_RDONLY,MPI_INFO_NULL,fh,ierr)
>                 !                   call MPI_FILE_SET_VIEW(fh,view_disp,
>                 !     +                  MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                 !     +                  MPI_INFO_NULL,ierr)
>                 !                   call MPI_FILE_READ_ALL(fh,tmp_old,
>                 !     +                 Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE
>                 !     +                  ,ierr)
>                     call read3D(tmp_old,1,1,2,fileStr31,fileview_3D)
933,939c1011,1019
<                     view_disp=8*Nx*Ny*Nz
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
<                     call MPI_FILE_READ_ALL(fh,tmp_old, &
<                     Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<                     ,ierr)
---
>                 !                   view_disp=8*Nx*Ny*Nz
> 
>                 !                   call MPI_FILE_SET_VIEW(fh,view_disp,
>                 !     +                  MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                 !     +                  MPI_INFO_NULL,ierr)
>                 !                   call MPI_FILE_READ_ALL(fh,tmp_old,
>                 !     +                 Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE
>                 !     +                  ,ierr)
>                     call read3D(tmp_old,1,1,2,fileStr32,fileview_3D)
941,947c1021,1029
<                     view_disp=2*8*Nx*Ny*Nz
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
<                     call MPI_FILE_READ_ALL(fh,tmp_old, &
<                     Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<                     ,ierr)
---
>                 !                   view_disp=2*8*Nx*Ny*Nz
> 
>                 !                   call MPI_FILE_SET_VIEW(fh,view_disp,
>                 !     +                  MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                 !     +                  MPI_INFO_NULL,ierr)
>                 !                   call MPI_FILE_READ_ALL(fh,tmp_old,
>                 !     +                 Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE
>                 !     +                  ,ierr)
>                     call read3D(tmp_old,1,1,2,fileStr33,fileview_3D)
949,955c1031,1039
<                     view_disp=3*8*Nx*Ny*Nz
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
<                     call MPI_FILE_READ_ALL(fh,tmp_old, &
<                     Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<                     ,ierr)
---
>                 !                   view_disp=3*8*Nx*Ny*Nz
> 
>                 !                   call MPI_FILE_SET_VIEW(fh,view_disp,
>                 !     +                  MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                 !     +                  MPI_INFO_NULL,ierr)
>                 !                   call MPI_FILE_READ_ALL(fh,tmp_old,
>                 !     +                 Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE
>                 !     +                  ,ierr)
>                     call read3D(tmp_old,1,1,2,fileStr34,fileview_3D)
957,963c1041,1049
<                     view_disp=4*8*Nx*Ny*Nz
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
<                     call MPI_FILE_READ_ALL(fh,tmp_old, &
<                     Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<                     ,ierr)
---
>                 !                   view_disp=4*8*Nx*Ny*Nz
> 
>                 !                   call MPI_FILE_SET_VIEW(fh,view_disp,
>                 !     +                  MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                 !     +                  MPI_INFO_NULL,ierr)
>                 !                   call MPI_FILE_READ_ALL(fh,tmp_old,
>                 !     +                 Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE
>                 !     +                  ,ierr)
>                     call read3D(tmp_old,1,1,2,fileStr35,fileview_3D)
965c1051,1052
<                     call MPI_FILE_CLOSE(fh,ierr)
---
>                 !                   call MPI_FILE_CLOSE(fh,ierr)
> 
967c1054
<                                        
---
> 
969c1056
<                                 
---
> 
971c1058
<                                 
---
> 
980c1067
<                                
---
> 
1014c1101
<                          
---
> 
1071c1158
<                             
---
> 
1080c1167
<                  
---
> 
1093c1180
<               
---
> 
1097a1185,1188
> !    call zeroslice(au,av,aw,ap,u2,v2,w2,w3,atxx,atxz,atyy, &
> !    atyz,atzz,atxy,p2,auw,avw,auv,adudz,adudx,advdz,adwdz,adwdx, &
> !    e,aCs2,aCs,abeta1,atxz_s,aESGS)
> 
1120c1211
<     if(me == 0)then! .AND. test_u == 1)then
---
>     if(me == 0 .AND. test_u == 1)then
1155c1246
< timeStep: DO  ttt=nrsub+1,Nsteps
---
>  timeStep:   DO  ttt=nrsub+1,Nsteps
1246c1337
<                                       
---
> 
1253c1344
<                                       
---
> 
1257c1348
<                                      
---
> 
1260c1351
<                                                     
---
> 
1264c1355
<                                                     
---
> 
1274c1365
<                                                     
---
> 
1277c1368
<                                                   
---
> 
1312c1403
<                         
---
> 
1315c1406
<                              
---
> 
1335c1426
<     !   Compute Statistics every c_count ****************************
---
>     !         Compute Statistics every c_count ****************************
1337c1428
<                          
---
> 
1373c1464,1470
<              
---
> 
> !            call avgslice(u,v,w,p,txx,txz,tyy,tyz,tzz,txy,dudz, &
> !            dudx,dvdz,dwdz,dwdx,Cs2,beta1,au,av,aw,ap,u2,v2, &
> !            w2,p2,w3,atxx,atxz,atyy,atyz,atzz,atxy,auw,avw, &
> !            auv,adudz,adudx,advdz,adwdz,adwdx,e,aCs2,aCs, &
> !            abeta1,atxz_s,ESGS3D,aESGS,ilow,wgx)
> 
1465c1562
<                         
---
> 
1531c1628
<                         
---
> 
1554c1651
<                         
---
> 
1596c1693
<                  
---
> 
1675a1773
> 
1685c1783
<         ! f(mod(t,press_step).eq.0)then
---
>         !    if(mod(t,press_step) == 0)then
1690c1788
<         ! ndif
---
>          !   endif
1698c1796,1798
<         call stepbl_UV (v,RHSy,RHSy_f,force_y)
---
>         Call stepbl_UV (v,RHSy,RHSy_f,force_y)
> 
>         Call stepbl_W (w, RHSz,RHSz_f)
1700,1701d1799
<         call stepbl_W (w, RHSz,RHSz_f)
<               
1703,1715c1801,1813
<     !         if(me.eq.0)then
<     !           write(*,*)sum((u(:,:,2:nzb+1)+Ugal)*u_star)/(Nx*Nyb*Nzb),
<     !     +           'u adv'
<     !            write(*,*)sum((abs(v(:,:,2:nzb+1))+Vgal)*u_star)
<     !     +           /(Nx*Nyb*Nzb),'v adv'
<     !            write(*,*)sum(abs(w(:,:,2:nzb+1))*u_star)/(Nx*Nyb*Nzb),
<     !     +           'w adv'
<     !            if(scalarCount.ge.1)then
<     !               write(*,*)sum(scalar(:,:,2:nzb+1,1))/(Nx*Nyb*Nzb),
<     !     +              'scalar adv'
<     !            endif
<     !            write(*,*)ttt,'time steps completed'
<     !         endif
---
>         if(me == 0)then
>             write(*,*)sum((u(:,:,2:nzb+1)+Ugal)*u_star)/(Nx*Nyb*Nzb), &
>             'u adv'
>             write(*,*)sum((abs(v(:,:,2:nzb+1))+Vgal)*u_star) &
>             /(Nx*Nyb*Nzb),'v adv'
>             write(*,*)sum(abs(w(:,:,2:nzb+1))*u_star)/(Nx*Nyb*Nzb), &
>             'w adv'
>         !            if(scalarCount.ge.1)then
>         !               write(*,*)sum(scalar(:,:,2:nzb+1,1))/(Nx*Nyb*Nzb),
>         !     +              'scalar adv'
>         !            endif
>         !            write(*,*)ttt,'time steps completed'
>         endif
1756a1855
> 
1771a1871
> 
1794c1894
<                                
---
> 
1796c1896
<                                       
---
> 
1807c1907
<                                
---
> 
1812c1912
<                                
---
> 
1819c1919,1951
<                                
---
> 
>             ! D averages
>                 do k=2,nzb+1
>                     do i=1,nx
>                         xz_bar(i,k)=sum(TL(i,:,k))/nyb
>                     enddo
>                 enddo
>                 call output_average(xz_bar/hprocs,320)
>                 do k=2,nzb+1
>                     do i=1,nx
>                         xz_bar(i,k)=sum(ESGS3D(i,:,k))/nyb
>                     enddo
>                 enddo
>                 call output_average(xz_bar/hprocs,321)
>                 do k=2,nzb+1
>                     do i=1,nx
>                         xz_bar(i,k)=sum((u(i,:,k)-sum(u(i,:,k))/nyb)**2)/nyb
>                     enddo
>                 enddo
>                 call output_average(xz_bar/hprocs,322)
>                 do k=2,nzb+1
>                     do i=1,nx
>                         xz_bar(i,k)=sum((v(i,:,k)-sum(v(i,:,k))/nyb)**2)/nyb
>                     enddo
>                 enddo
>                 call output_average(xz_bar/hprocs,323)
>                 do k=2,nzb+1
>                     do i=1,nx
>                         xz_bar(i,k)=sum((w(i,:,k)-sum(w(i,:,k))/nyb)**2)/nyb
>                     enddo
>                 enddo
>                 call output_average(xz_bar/hprocs,324)
> 
1850c1982
<                                
---
> 
1887c2019
<                                              
---
> 
1890c2022
<                                
---
> 
1892c2024,2028
<              
---
> 
> !            call zeroslice(au,av,aw,ap,u2,v2,w2,w3,atxx,atxz,atyy, &
> !            atyz,atzz,atxy,p2,auw,avw,auv,adudz,adudx,advdz,adwdz, &
> !            adwdx,e,aCs2,aCs,abeta1,atxz_s,aESGS)
> 
1904c2040
<                  
---
> 
1909c2045
<     ! cc  Write frames
---
> !   Write frames
1911c2047
<         if(nframe>0)then
---
>          if(nframe>0)then
1913,1918c2049,2053
<             if(t>1 .AND. output_frames(8) .AND. &
<             ttt >= sframe .AND. ttt <= sframe+(nframe-1)*framestep)then
<                 if(ttt == sframe .OR. mod(ttt-sframe,framestep) == 0)then
<                     call calc_lambda2(lambda2,dudx,dudy,dudz,dvdx,dvdy,dvdz, &
<                     dwdx,dwdy,dwdz)
<                 end if
---
>             if(t>1 .and. output_frames(8).and. &
>              ttt.ge.sframe.and.ttt.le.sframe+(nframe-1)*framestep)then
>             if(ttt.eq.sframe.or.mod(ttt-sframe,framestep).eq.0)then
>                call calc_lambda2(lambda2,dudx,dudy,dudz,dvdx,dvdy,dvdz, &
>                    dwdx,dwdy,dwdz)
1920c2055,2056
<                         
---
>             end if
>             
1922,1924c2058,2060
<             scalar(:,:,:,1))
<                            
<         end if
---
>                 scalar(:,:,:,1))
>                
>          end if             
1928c2064
<              
---
> 
1943c2079
<                         
---
> 
1945c2081,2084
<                         
---
>             if(me == 0) write(*,*) 'u(3,3,3): ', u(3,3,3)
>         ! ndo Gallilean transformation
>             u=u+Ugal
>             v=v+Vgal
1951,1955c2090,2091
<         ! undo Gallilean transformation
<             u=u+Ugal
<             v=v+Vgal
< 
<             call MPI_FILE_OPEN(nall,'checkpoints/vel.break', &
---
>             view_disp=0
>             call MPI_FILE_OPEN(nall,'checkpoints/u.break', &
1958,1978c2094
<             view_disp=0
<             call MPI_FILE_SET_VIEW(fh,view_disp, &
<             MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<             MPI_INFO_NULL,ierr)
<             call MPI_FILE_WRITE_ALL(fh,u(1,1,2), &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<             ,ierr)
<             view_disp=8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp, &
<             MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<             MPI_INFO_NULL,ierr)
<             call MPI_FILE_WRITE_ALL(fh,v(1,1,2), &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<             ,ierr)
<             view_disp=2*8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp, &
<             MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<             MPI_INFO_NULL,ierr)
<             call MPI_FILE_WRITE_ALL(fh,w(1,1,2), &
<             Nx*Nyb*Nzb,MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE &
<             ,ierr)
---
>             call write3D(fh,u,1,1,2,fileview_3D,view_disp)
1980,1982c2096,2108
<             view_disp=0
< 
<         ! non-dimensionalize
---
>             call MPI_FILE_OPEN(nall,'checkpoints/v.break', &
>             MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>             fh,ierr)
>             call write3D(fh,v,1,1,2,fileview_3D,view_disp)
>             call MPI_FILE_CLOSE(fh,ierr)
>             call MPI_FILE_OPEN(nall,'checkpoints/w.break', &
>             MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>             fh,ierr)
>             call write3D(fh,w,1,1,2,fileview_3D,view_disp)
>             call MPI_FILE_CLOSE(fh,ierr)
> 
> 
>         ! non-dimensionalize
1987c2113
<         ! Gallilean transformation
---
>         ! allilean transformation
1991c2117
<             IF(npart > 0)THEN
---
>             IF(npart > 0 .AND. me == 0)THEN
1994,1995c2120,2129
<                 if( me == 0 )then
< 
---
>                 open(unit=390,file= &
>                 'checkpoints/ParticlePositions_nomodel.break')
>                 write(390,*)ipart
>                 do i=1,ipart
>                     write(390,*)particle(i,1,1),particle(i,2,1), &
>                     particle(i,3,1),particle(i,4,1), &
>                     particle(i,5,1),particle(i,6,1)
>                 enddo
>                 close(unit=390)
>                 if(part_model == 2)then
1997c2131,2132
<                     'checkpoints/ParticlePositions_nomodel.break')
---
>                     'checkpoints/ParticlePositions_weiliso.break', &
>                     form='formatted')
2000,2002c2135,2137
<                         write(390,*)particle(i,1,1),particle(i,2,1), &
<                         particle(i,3,1),particle(i,4,1), &
<                         particle(i,5,1),particle(i,6,1)
---
>                         write(390,*)particle(i,1,2),particle(i,2,2), &
>                         particle(i,3,2),particle(i,4,2), &
>                         particle(i,5,2),particle(i,6,1)
2005,2018c2140
<                     if(part_model == 2)then
<                         open(unit=390,file= &
<                         'checkpoints/ParticlePositions_weiliso.break', &
<                         form='formatted')
<                         write(390,*)ipart
<                         do i=1,ipart
<                             write(390,*)particle(i,1,2),particle(i,2,2), &
<                             particle(i,3,2),particle(i,4,2), &
<                             particle(i,5,2),particle(i,6,1)
<                         enddo
<                         close(unit=390)
<                     endif
< 
<                 end if
---
>                 endif
2022,2030c2144,2149
<                     if( me == 0 )then
<                         call MPI_FILE_OPEN(MPI_COMM_SELF, &
<                         'checkpoints/SGS_velocity.break', &
<                         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
<                         fh,ierr)
<                         call MPI_FILE_WRITE(fh,us_f(1,1,1),npart*3*2, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                         call MPI_FILE_CLOSE(fh,ierr)
<                     end if
---
>                     call MPI_FILE_OPEN(MPI_COMM_SELF, &
>                     'checkpoints/SGS_velocity.break',MPI_MODE_WRONLY &
>                     +MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
>                     call MPI_FILE_WRITE(fh,us_f(1,1,1),npart*3*2, &
>                     MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>                     call MPI_FILE_CLOSE(fh,ierr)
2036,2039d2154
<                     view_disp=0
<                     call MPI_FILE_SET_VIEW(fh,view_disp, &
<                     MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                     MPI_INFO_NULL,ierr)
2046c2161
<                         
---
> 
2048,2064c2163,2167
<                         
<             call MPI_FILE_OPEN(nall,'checkpoints/RHS_mom.break', &
<             MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_WRITE_ALL(fh,RHSx(1,1,2),Nx*Nyb*Nzb, &
<             MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<             view_disp=8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_WRITE_ALL(fh,RHSy(1,1,2),Nx*Nyb*Nzb, &
<             MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<             view_disp=2*8*Nx*Ny*Nz
<             call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<             fileview_3D,"native",MPI_INFO_NULL,ierr)
<             call MPI_FILE_WRITE_ALL(fh,RHSz(1,1,2),Nx*Nyb*Nzb, &
<             MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
> 
>             call MPI_FILE_OPEN(nall,'checkpoints/RHS_momX.break', &
>             MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>             fh,ierr)
>             call write3D(fh,RHSx,1,1,2,fileview_3D,view_disp)
2066,2067c2169,2180
<             view_disp=0
<                         
---
>             call MPI_FILE_OPEN(nall,'checkpoints/RHS_momY.break', &
>             MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>             fh,ierr)
>             call write3D(fh,RHSy,1,1,2,fileview_3D,view_disp)
>             call MPI_FILE_CLOSE(fh,ierr)
>             call MPI_FILE_OPEN(nall,'checkpoints/RHS_momZ.break', &
>             MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>             fh,ierr)
>             call write3D(fh,RHSz,1,1,2,fileview_3D,view_disp)
>             call MPI_FILE_CLOSE(fh,ierr)
> 
> 
2070,2071c2183,2185
<                             
<                 call MPI_FILE_OPEN(nall,'checkpoints/a1_e1.break', &
---
> 
>                 tmp_old=a1_old(:,2:nyb+1,2:nzb+1)
>                 call MPI_FILE_OPEN(nall,'checkpoints/a1.break', &
2074,2083c2188,2189
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
<                 tmp_old=a1_old(:,2:nyb+1,2:nzb+1)
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2085,2086c2191,2194
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>                 call MPI_FILE_OPEN(nall,'checkpoints/b1.break', &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
2088,2089c2196,2197
<                 view_disp=0
<                             
---
> 
> 
2092,2093c2200,2202
<                             
<                 call MPI_FILE_OPEN(nall,'checkpoints/a1_e1.break', &
---
> 
>                 tmp_old=a1_old(:,2:nyb+1,2:nzb+1)
>                 call MPI_FILE_OPEN(nall,'checkpoints/a1.break', &
2096,2105c2205,2206
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
<                 tmp_old=a1_old(:,2:nyb+1,2:nzb+1)
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2107,2112c2208,2212
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=2*8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,'checkpoints/b1.break', &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2114,2119c2214,2218
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=3*8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,'checkpoints/c1.break', &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2121,2129c2220,2223
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=4*8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
<                 tmp_old=e1_old(:,2:nyb+1,2:nzb+1)
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>                 call MPI_FILE_OPEN(nall,'checkpoints/d1.break', &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
2131,2133c2225,2226
<                 view_disp=0
< 
<                 call MPI_FILE_OPEN(nall,'checkpoints/a2_e2.break', &
---
>                 tmp_old=e1_old(:,2:nyb+1,2:nzb+1)
>                 call MPI_FILE_OPEN(nall,'checkpoints/e1.break', &
2136,2138c2229,2230
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2140,2144c2232,2236
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<                 fileview_3D,"native",MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,'checkpoints/a2.break', &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2146,2150c2238,2242
<                 call MPI_FILE_WRITE_ALL(fh,b2_old(1,2,2),Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=2*8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<                 fileview_3D,"native",MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,'checkpoints/b2.break', &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2152,2157c2244,2248
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=3*8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,'checkpoints/c2.break', &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2159,2163c2250,2254
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=4*8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<                 fileview_3D,"native",MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,'checkpoints/d2.break', &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2165,2166c2256,2259
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>                 call MPI_FILE_OPEN(nall,'checkpoints/e2.break', &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
2168,2169c2261,2263
<                 view_disp=0
<                             
---
> 
> 
> 
2171c2265
<                      
---
> 
2180a2275,2284
>                         write(fileStr21, '(A)') &
>                         'checkpoints/a4_temperature.break'
>                         write(fileStr22, '(A)') &
>                         'checkpoints/b4_temperature.break'
>                         write(fileStr23, '(A)') &
>                         'checkpoints/c4_temperature.break'
>                         write(fileStr24, '(A)') &
>                         'checkpoints/d4_temperature.break'
>                         write(fileStr25, '(A)') &
>                         'checkpoints/e4_temperature.break'
2182a2287,2296
>                         write(fileStr31, '(A)') &
>                         'checkpoints/a8_temperature.break'
>                         write(fileStr32, '(A)') &
>                         'checkpoints/b8_temperature.break'
>                         write(fileStr33, '(A)') &
>                         'checkpoints/c8_temperature.break'
>                         write(fileStr34, '(A)') &
>                         'checkpoints/d8_temperature.break'
>                         write(fileStr35, '(A)') &
>                         'checkpoints/e8_temperature.break'
2191a2306,2315
>                         write(fileStr21, '(A)') &
>                         'checkpoints/a4_moisture.break'
>                         write(fileStr22, '(A)') &
>                         'checkpoints/b4_moisture.break'
>                         write(fileStr23, '(A)') &
>                         'checkpoints/c4_moisture.break'
>                         write(fileStr24, '(A)') &
>                         'checkpoints/d4_moisture.break'
>                         write(fileStr25, '(A)') &
>                         'checkpoints/e4_moisture.break'
2193a2318,2327
>                         write(fileStr31, '(A)') &
>                         'checkpoints/a8_moisture.break'
>                         write(fileStr32, '(A)') &
>                         'checkpoints/b8_moisture.break'
>                         write(fileStr33, '(A)') &
>                         'checkpoints/c8_moisture.break'
>                         write(fileStr34, '(A)') &
>                         'checkpoints/d8_moisture.break'
>                         write(fileStr35, '(A)') &
>                         'checkpoints/e8_moisture.break'
2201,2210c2335,2364
<                         write(fileStr1, '(A,I1,A)')'checkpoints/scalar', &
<                         scalarIter,'.break'
<                         write(fileStr2, '(A,I1,A)')'checkpoints/a4_e4_scalar', &
<                         scalarIter,'.break'
<                         write(fileStr3, '(A,I1,A)')'checkpoints/a8_e8_scalar', &
<                         scalarIter,'.break'
<                         write(fileStr4, '(A,I1,A)')'checkpoints/RHS_scalar', &
<                         scalarIter,'.break'
<                         write(fileStr5, '(A,I1,A)')'checkpoints/dsdt_scalar', &
<                         scalarIter,'.break'
---
>                         write(fileStr1, '(A,I1,A)') &
>                         'checkpoints/scalar.break',scalarIter,'.break'
>                         write(fileStr2, '(A,I1,A)') &
>                         'checkpoints/a4_e4_scalar.break',scalarIter,'.break'
>                         write(fileStr21, '(A,I1,A)') &
>                         'checkpoints/a4_scalar.break',scalarIter,'.break'
>                         write(fileStr22, '(A,I1,A)') &
>                         'checkpoints/b4_scalar.break',scalarIter,'.break'
>                         write(fileStr23, '(A,I1,A)') &
>                         'checkpoints/c4_scalar.break',scalarIter,'.break'
>                         write(fileStr24, '(A,I1,A)') &
>                         'checkpoints/d4_scalar.break',scalarIter,'.break'
>                         write(fileStr25, '(A,I1,A)') &
>                         'checkpoints/e4_scalar.break',scalarIter,'.break'
>                         write(fileStr3, '(A,I1,A)') &
>                         'checkpoints/a8_e8_scalar.break',scalarIter,'.break'
>                         write(fileStr31, '(A,I1,A)') &
>                         'checkpoints/a8_scalar.break',scalarIter,'.break'
>                         write(fileStr32, '(A,I1,A)') &
>                         'checkpoints/b8_scalar.break',scalarIter,'.break'
>                         write(fileStr33, '(A,I1,A)') &
>                         'checkpoints/c8_scalar.break',scalarIter,'.break'
>                         write(fileStr34, '(A,I1,A)') &
>                         'checkpoints/d8_scalar.break',scalarIter,'.break'
>                         write(fileStr35, '(A,I1,A)') &
>                         'checkpoints/e8_scalar.break',scalarIter,'.break'
>                         write(fileStr4, '(A,I1,A)') &
>                         'checkpoints/RHS_scalar.break',scalarIter,'.break'
>                         write(fileStr5, '(A,I1,A)') &
>                         'checkpoints/dsdt_scalar.break',scalarIter,'.break'
2214c2368
<                                    
---
> 
2222c2376
<                                    
---
> 
2225,2226c2379,2384
<                                           
<                         call MPI_FILE_OPEN(nall,filestr2,MPI_MODE_WRONLY+ &
---
> 
> 
>                         write(fileStr2, '(A)') &
>                         'checkpoints/a4_e4_temperature.break'
> 
>                         call MPI_FILE_OPEN(nall,filestr21,MPI_MODE_WRONLY+ &
2228,2230d2385
<                         call MPI_FILE_SET_VIEW(fh,view_disp, &
<                         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                         MPI_INFO_NULL,ierr)
2232,2237c2387,2391
<                         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                         view_disp=8*Nx*Ny*Nz
<                         call MPI_FILE_SET_VIEW(fh,view_disp, &
<                         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                         MPI_INFO_NULL,ierr)
---
>                         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                         call MPI_FILE_CLOSE(fh,ierr)
> 
>                         call MPI_FILE_OPEN(nall,filestr22,MPI_MODE_WRONLY+ &
>                         MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
2239,2240c2393
<                         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>                         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
2242,2243c2395,2396
<                         view_disp=0
<                                           
---
> 
> 
2246,2251c2399,2400
<                                           
<                         call MPI_FILE_OPEN(nall,filestr2,MPI_MODE_WRONLY+ &
<                         MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
<                         call MPI_FILE_SET_VIEW(fh,view_disp, &
<                         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                         MPI_INFO_NULL,ierr)
---
> 
> 
2253,2258c2402,2406
<                         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                         view_disp=8*Nx*Ny*Nz
<                         call MPI_FILE_SET_VIEW(fh,view_disp, &
<                         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                         MPI_INFO_NULL,ierr)
---
>                         call MPI_FILE_OPEN(nall,filestr21, &
>                         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                         fh,ierr)
>                         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                         call MPI_FILE_CLOSE(fh,ierr)
2260,2265c2408,2412
<                         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                         view_disp=2*8*Nx*Ny*Nz
<                         call MPI_FILE_SET_VIEW(fh,view_disp, &
<                         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                         MPI_INFO_NULL,ierr)
---
>                         call MPI_FILE_OPEN(nall,filestr22, &
>                         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                         fh,ierr)
>                         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                         call MPI_FILE_CLOSE(fh,ierr)
2267,2272c2414,2418
<                         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                         view_disp=3*8*Nx*Ny*Nz
<                         call MPI_FILE_SET_VIEW(fh,view_disp, &
<                         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                         MPI_INFO_NULL,ierr)
---
>                         call MPI_FILE_OPEN(nall,filestr23, &
>                         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                         fh,ierr)
>                         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                         call MPI_FILE_CLOSE(fh,ierr)
2274,2279c2420,2424
<                         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                         view_disp=4*8*Nx*Ny*Nz
<                         call MPI_FILE_SET_VIEW(fh,view_disp, &
<                         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                         MPI_INFO_NULL,ierr)
---
>                         call MPI_FILE_OPEN(nall,filestr24, &
>                         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                         fh,ierr)
>                         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                         call MPI_FILE_CLOSE(fh,ierr)
2281,2282c2426,2429
<                         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>                         call MPI_FILE_OPEN(nall,filestr25, &
>                         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                         fh,ierr)
>                         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
2286,2290d2432
<                         call MPI_FILE_OPEN(nall,filestr3,MPI_MODE_WRONLY+ &
<                         MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
<                         call MPI_FILE_SET_VIEW(fh,view_disp, &
<                         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                         MPI_INFO_NULL,ierr)
2292,2297c2434,2438
<                         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                         view_disp=8*Nx*Ny*Nz
<                         call MPI_FILE_SET_VIEW(fh,view_disp, &
<                         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                         MPI_INFO_NULL,ierr)
---
>                         call MPI_FILE_OPEN(nall,fileStr31, &
>                         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                         fh,ierr)
>                         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                         call MPI_FILE_CLOSE(fh,ierr)
2299,2304c2440,2444
<                         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                         view_disp=2*8*Nx*Ny*Nz
<                         call MPI_FILE_SET_VIEW(fh,view_disp, &
<                         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                         MPI_INFO_NULL,ierr)
---
>                         call MPI_FILE_OPEN(nall,fileStr32, &
>                         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                         fh,ierr)
>                         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                         call MPI_FILE_CLOSE(fh,ierr)
2306,2311c2446,2450
<                         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                         view_disp=3*8*Nx*Ny*Nz
<                         call MPI_FILE_SET_VIEW(fh,view_disp, &
<                         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                         MPI_INFO_NULL,ierr)
---
>                         call MPI_FILE_OPEN(nall,fileStr33, &
>                         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                         fh,ierr)
>                         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                         call MPI_FILE_CLOSE(fh,ierr)
2313,2318c2452,2456
<                         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                         view_disp=4*8*Nx*Ny*Nz
<                         call MPI_FILE_SET_VIEW(fh,view_disp, &
<                         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                         MPI_INFO_NULL,ierr)
---
>                         call MPI_FILE_OPEN(nall,fileStr34, &
>                         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                         fh,ierr)
>                         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                         call MPI_FILE_CLOSE(fh,ierr)
2320,2321c2458,2461
<                         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>                         call MPI_FILE_OPEN(nall,fileStr35, &
>                         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                         fh,ierr)
>                         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
2324a2465,2543
> 
>                     !                  call MPI_FILE_OPEN(nall,filestr2,MPI_MODE_WRONLY+
>                     !     +                 MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
>                     !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>                     !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                     !     +                 MPI_INFO_NULL,ierr)
>                     !                  tmp_old=a4_old(:,2:nyb+1,2:nzb+1,l)
>                     !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>                     !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>                     !                  view_disp=8*Nx*Ny*Nz
>                     !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>                     !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                     !     +                 MPI_INFO_NULL,ierr)
>                     !                  tmp_old=b4_old(:,2:nyb+1,2:nzb+1,l)
>                     !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>                     !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>                     !                  view_disp=2*8*Nx*Ny*Nz
>                     !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>                     !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                     !     +                 MPI_INFO_NULL,ierr)
>                     !                  tmp_old=c4_old(:,2:nyb+1,2:nzb+1,l)
>                     !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>                     !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>                     !                  view_disp=3*8*Nx*Ny*Nz
>                     !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>                     !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                     !     +                 MPI_INFO_NULL,ierr)
>                     !                  tmp_old=d4_old(:,2:nyb+1,2:nzb+1,l)
>                     !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>                     !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>                     !                  view_disp=4*8*Nx*Ny*Nz
>                     !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>                     !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                     !     +                 MPI_INFO_NULL,ierr)
>                     !                  tmp_old=e4_old(:,2:nyb+1,2:nzb+1,l)
>                     !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>                     !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>                     !                  call MPI_FILE_CLOSE(fh,ierr)
>                     !                  view_disp=0
> 
>                     !                  call MPI_FILE_OPEN(nall,filestr3,MPI_MODE_WRONLY+
>                     !     +                 MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
>                     !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>                     !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                     !     +                 MPI_INFO_NULL,ierr)
>                     !                  tmp_old=a8_old(:,2:nyb+1,2:nzb+1,l)
>                     !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>                     !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>                     !                  view_disp=8*Nx*Ny*Nz
>                     !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>                     !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                     !     +                 MPI_INFO_NULL,ierr)
>                     !                  tmp_old=b8_old(:,2:nyb+1,2:nzb+1,l)
>                     !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>                     !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>                     !                  view_disp=2*8*Nx*Ny*Nz
>                     !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>                     !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                     !     +                 MPI_INFO_NULL,ierr)
>                     !                  tmp_old=c8_old(:,2:nyb+1,2:nzb+1,l)
>                     !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>                     !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>                     !                  view_disp=3*8*Nx*Ny*Nz
>                     !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>                     !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                     !     +                 MPI_INFO_NULL,ierr)
>                     !                  tmp_old=d8_old(:,2:nyb+1,2:nzb+1,l)
>                     !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>                     !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>                     !                  view_disp=4*8*Nx*Ny*Nz
>                     !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>                     !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>                     !     +                 MPI_INFO_NULL,ierr)
>                     !                  tmp_old=e8_old(:,2:nyb+1,2:nzb+1,l)
>                     !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>                     !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>                     !                  call MPI_FILE_CLOSE(fh,ierr)
>                     !                  view_disp=0
> 
2328c2547
<                                 
---
> 
2339c2558
<                                 
---
> 
2349c2568
<                                        
---
> 
2359c2578
<                               
---
> 
2361c2580
<                                 
---
> 
2366c2585
< END DO timeStep
---
>   END DO timeStep
2392c2611
<      
---
> 
2394,2398d2612
<           
< ! dimensionalize
<     u=u*u_star
<     v=v*u_star
<     w=w*u_star
2400c2614
< ! undo Gallilean transformation
---
> ! ndo Gallilean transformation
2404,2405c2618,2622
<     call MPI_FILE_OPEN(nall,'checkpoints/vel.break',MPI_MODE_WRONLY+ &
<     MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
---
> ! imensionalize
>     u=u*u_star
>     v=v*u_star
>     w=w*u_star
> 
2407,2420c2624,2637
<     call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<     fileview_3D,"native",MPI_INFO_NULL,ierr)
<     call MPI_FILE_WRITE_ALL(fh,u(1,1,2),Nx*Nyb*Nzb, &
<     MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<     view_disp=8*Nx*Ny*Nz
<     call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<     fileview_3D,"native",MPI_INFO_NULL,ierr)
<     call MPI_FILE_WRITE_ALL(fh,v(1,1,2),Nx*Nyb*Nzb, &
<     MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<     view_disp=2*8*Nx*Ny*Nz
<     call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<     fileview_3D,"native",MPI_INFO_NULL,ierr)
<     call MPI_FILE_WRITE_ALL(fh,w(1,1,2),Nx*Nyb*Nzb, &
<     MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>     call MPI_FILE_OPEN(nall,'checkpoints/u.break', &
>     MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>     fh,ierr)
>     call write3D(fh,u,1,1,2,fileview_3D,view_disp)
>     call MPI_FILE_CLOSE(fh,ierr)
>     call MPI_FILE_OPEN(nall,'checkpoints/v.break', &
>     MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>     fh,ierr)
>     call write3D(fh,v,1,1,2,fileview_3D,view_disp)
>     call MPI_FILE_CLOSE(fh,ierr)
>     call MPI_FILE_OPEN(nall,'checkpoints/w.break', &
>     MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>     fh,ierr)
>     call write3D(fh,w,1,1,2,fileview_3D,view_disp)
2422d2638
<     view_disp=0
2424,2425c2640,2658
<     IF(npart > 0)THEN
<     ! cc  Write Particle Positions
---
> !      call MPI_FILE_OPEN(nall,'checkpoints/vel.break',MPI_MODE_WRONLY+
> !     +     MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
> !      view_disp=0
> !      call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
> !     +     fileview_3D,"native",MPI_INFO_NULL,ierr)
> !      call MPI_FILE_WRITE_ALL(fh,u(1,1,2),Nx*Nyb*Nzb,
> !     +     MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
> !      view_disp=8*Nx*Ny*Nz
> !      call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
> !     +     fileview_3D,"native",MPI_INFO_NULL,ierr)
> !      call MPI_FILE_WRITE_ALL(fh,v(1,1,2),Nx*Nyb*Nzb,
> !     +     MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
> !      view_disp=2*8*Nx*Ny*Nz
> !     call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
> !     +     fileview_3D,"native",MPI_INFO_NULL,ierr)
> !      call MPI_FILE_WRITE_ALL(fh,w(1,1,2),Nx*Nyb*Nzb,
> !     +     MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
> !      call MPI_FILE_CLOSE(fh,ierr)
> !      view_disp=0
2427c2660,2661
<         if( me == 0 )then
---
>     IF(npart > 0 .AND. me == 0)THEN
>     ! cc  Write Particle Positions
2429,2430c2663,2674
<             open(unit=390,file= &
<             'checkpoints/ParticlePositions_nomodel.break')
---
>         open(unit=390, &
>         file='checkpoints/ParticlePositions_nomodel.break', &
>         form='formatted')
>         write(390,*)ipart
>         do i=1,ipart
>             write(390,*)particle(i,:,1)
>         enddo
>         close(unit=390)
>         if(part_model == 2)then
>             open(unit=390, &
>             file='checkpoints/ParticlePositions_weiliso.break', &
>             form='formatted')
2433,2435c2677
<                 write(390,*)particle(i,1,1),particle(i,2,1), &
<                 particle(i,3,1),particle(i,4,1), &
<                 particle(i,5,1),particle(i,6,1)
---
>                 write(390,*)particle(i,:,2)
2438,2452c2680,2683
<             if(part_model == 2)then
<                 open(unit=390,file= &
<                 'checkpoints/ParticlePositions_weiliso.break', &
<                 form='formatted')
<                 write(390,*)ipart
<                 do i=1,ipart
<                     write(390,*)particle(i,1,2),particle(i,2,2), &
<                     particle(i,3,2),particle(i,4,2), &
<                     particle(i,5,2),particle(i,6,1)
<                 enddo
<                 close(unit=390)
<             endif
<                          
<         end if
<                        
---
>         endif
> 
>     ! cc  Write SGS Particle Velocity
> 
2455,2464c2686,2692
<             if( me == 0 )then
<                 call MPI_FILE_OPEN(MPI_COMM_SELF, &
<                 'checkpoints/SGS_velocity.break', &
<                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
<                 fh,ierr)
<                 call MPI_FILE_WRITE(fh,us_f(1,1,1),npart*3*2, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 call MPI_FILE_CLOSE(fh,ierr)
<             end if
<                          
---
>             call MPI_FILE_OPEN(MPI_COMM_SELF, &
>             'checkpoints/SGS_velocity.break',MPI_MODE_WRONLY &
>             +MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
>             call MPI_FILE_WRITE(fh,us_f(1,1,1),npart*3*2, &
>             MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             call MPI_FILE_CLOSE(fh,ierr)
> 
2469,2472d2696
<             view_disp=0
<             call MPI_FILE_SET_VIEW(fh,view_disp, &
<             MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<             MPI_INFO_NULL,ierr)
2477c2701
<                   
---
> 
2481,2497c2705,2719
<           
<     call MPI_FILE_OPEN(nall,'checkpoints/RHS_mom.break', &
<     MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
<     call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<     fileview_3D,"native",MPI_INFO_NULL,ierr)
<     call MPI_FILE_WRITE_ALL(fh,RHSx(1,1,2),Nx*Nyb*Nzb, &
<     MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<     view_disp=8*Nx*Ny*Nz
<     call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<     fileview_3D,"native",MPI_INFO_NULL,ierr)
<     call MPI_FILE_WRITE_ALL(fh,RHSy(1,1,2),Nx*Nyb*Nzb, &
<     MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<     view_disp=2*8*Nx*Ny*Nz
<     call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<     fileview_3D,"native",MPI_INFO_NULL,ierr)
<     call MPI_FILE_WRITE_ALL(fh,RHSz(1,1,2),Nx*Nyb*Nzb, &
<     MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
> 
>     call MPI_FILE_OPEN(nall,'checkpoints/RHS_momX.break', &
>     MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>     fh,ierr)
>     call write3D(fh,RHSx,1,1,2,fileview_3D,view_disp)
>     call MPI_FILE_CLOSE(fh,ierr)
>     call MPI_FILE_OPEN(nall,'checkpoints/RHS_momY.break', &
>     MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>     fh,ierr)
>     call write3D(fh,RHSy,1,1,2,fileview_3D,view_disp)
>     call MPI_FILE_CLOSE(fh,ierr)
>     call MPI_FILE_OPEN(nall,'checkpoints/RHS_momZ.break', &
>     MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>     fh,ierr)
>     call write3D(fh,RHSz,1,1,2,fileview_3D,view_disp)
2499c2721,2739
<     view_disp=0
---
> 
> !         call MPI_FILE_OPEN(nall,'checkpoints/RHS_mom.break',
> !     +     MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
> !         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
> !     +        fileview_3D,"native",MPI_INFO_NULL,ierr)
> !         call MPI_FILE_WRITE_ALL(fh,RHSx(1,1,2),Nx*Nyb*Nzb,
> !     +        MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
> !         view_disp=8*Nx*Ny*Nz
> !         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
> !     +        fileview_3D,"native",MPI_INFO_NULL,ierr)
> !         call MPI_FILE_WRITE_ALL(fh,RHSy(1,1,2),Nx*Nyb*Nzb,
> !     +        MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
> !         view_disp=2*8*Nx*Ny*Nz
> !         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
> !     +        fileview_3D,"native",MPI_INFO_NULL,ierr)
> !         call MPI_FILE_WRITE_ALL(fh,RHSz(1,1,2),Nx*Nyb*Nzb,
> !     +        MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
> !         call MPI_FILE_CLOSE(fh,ierr)
>     1 view_disp=0
2504c2744,2745
<         call MPI_FILE_OPEN(nall,'checkpoints/a1_e1.break', &
---
>         tmp_old=a1_old(:,2:nyb+1,2:nzb+1)
>         call MPI_FILE_OPEN(nall,'checkpoints/a1.break', &
2507,2516c2748,2749
<         call MPI_FILE_SET_VIEW(fh,view_disp, &
<         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<         MPI_INFO_NULL,ierr)
<         tmp_old=a1_old(:,2:nyb+1,2:nzb+1)
<         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp, &
<         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<         MPI_INFO_NULL,ierr)
---
>         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>         call MPI_FILE_CLOSE(fh,ierr)
2518,2519c2751,2754
<         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>         call MPI_FILE_OPEN(nall,'checkpoints/b1.break', &
>         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>         fh,ierr)
>         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
2521c2756,2774
<         view_disp=0
---
> 
>     !            call MPI_FILE_OPEN(nall,'checkpoints/a1_e1.break',
>     !     +           MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL,
>     !     +           fh,ierr)
>     !            call MPI_FILE_SET_VIEW(fh,view_disp,
>     !     +           MPI_DOUBLE_PRECISION,fileview_3D,"native",
>     !     +           MPI_INFO_NULL,ierr)
>     !            tmp_old=a1_old(:,2:nyb+1,2:nzb+1)
>     !            call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>     !     +           MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !            view_disp=8*Nx*Ny*Nz
>     !            call MPI_FILE_SET_VIEW(fh,view_disp,
>     !     +           MPI_DOUBLE_PRECISION,fileview_3D,"native",
>     !     +           MPI_INFO_NULL,ierr)
>     !            tmp_old=b1_old(:,2:nyb+1,2:nzb+1)
>     !            call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>     !     +           MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !            call MPI_FILE_CLOSE(fh,ierr)
>     !            view_disp=0
2526c2779,2780
<         call MPI_FILE_OPEN(nall,'checkpoints/a1_e1.break', &
---
>         tmp_old=a1_old(:,2:nyb+1,2:nzb+1)
>         call MPI_FILE_OPEN(nall,'checkpoints/a1.break', &
2529,2538c2783,2784
<         call MPI_FILE_SET_VIEW(fh,view_disp, &
<         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<         MPI_INFO_NULL,ierr)
<         tmp_old=a1_old(:,2:nyb+1,2:nzb+1)
<         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp, &
<         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<         MPI_INFO_NULL,ierr)
---
>         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>         call MPI_FILE_CLOSE(fh,ierr)
2540,2545c2786,2790
<         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=2*8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp, &
<         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<         MPI_INFO_NULL,ierr)
---
>         call MPI_FILE_OPEN(nall,'checkpoints/b1.break', &
>         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>         fh,ierr)
>         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>         call MPI_FILE_CLOSE(fh,ierr)
2547,2552c2792,2796
<         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=3*8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp, &
<         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<         MPI_INFO_NULL,ierr)
---
>         call MPI_FILE_OPEN(nall,'checkpoints/c1.break', &
>         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>         fh,ierr)
>         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>         call MPI_FILE_CLOSE(fh,ierr)
2554,2559c2798,2802
<         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=4*8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp, &
<         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<         MPI_INFO_NULL,ierr)
---
>         call MPI_FILE_OPEN(nall,'checkpoints/d1.break', &
>         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>         fh,ierr)
>         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>         call MPI_FILE_CLOSE(fh,ierr)
2561,2562c2804,2807
<         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>         call MPI_FILE_OPEN(nall,'checkpoints/e1.break', &
>         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>         fh,ierr)
>         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
2564d2808
<         view_disp=0
2566c2810,2811
<         call MPI_FILE_OPEN(nall,'checkpoints/a2_e2.break', &
---
>         tmp_old=a2_old(:,2:nyb+1,2:nzb+1)
>         call MPI_FILE_OPEN(nall,'checkpoints/a2.break', &
2569,2577c2814,2815
<         call MPI_FILE_SET_VIEW(fh,view_disp, &
<         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<         MPI_INFO_NULL,ierr)
<         tmp_old=a2_old(:,2:nyb+1,2:nzb+1)
<         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<         fileview_3D,"native",MPI_INFO_NULL,ierr)
---
>         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>         call MPI_FILE_CLOSE(fh,ierr)
2579,2583c2817,2821
<         call MPI_FILE_WRITE_ALL(fh,b2_old(1,2,2),Nx*Nyb*Nzb, &
<         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=2*8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<         fileview_3D,"native",MPI_INFO_NULL,ierr)
---
>         call MPI_FILE_OPEN(nall,'checkpoints/b2.break', &
>         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>         fh,ierr)
>         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>         call MPI_FILE_CLOSE(fh,ierr)
2585,2590c2823,2827
<         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=3*8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp, &
<         MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<         MPI_INFO_NULL,ierr)
---
>         call MPI_FILE_OPEN(nall,'checkpoints/c2.break', &
>         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>         fh,ierr)
>         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>         call MPI_FILE_CLOSE(fh,ierr)
2592,2596c2829,2833
<         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<         view_disp=4*8*Nx*Ny*Nz
<         call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION, &
<         fileview_3D,"native",MPI_INFO_NULL,ierr)
---
>         call MPI_FILE_OPEN(nall,'checkpoints/d2.break', &
>         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>         fh,ierr)
>         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>         call MPI_FILE_CLOSE(fh,ierr)
2598,2599c2835,2838
<         call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<         MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>         call MPI_FILE_OPEN(nall,'checkpoints/e2.break', &
>         MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>         fh,ierr)
>         call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
2601c2840,2916
<         view_disp=0
---
> 
>     !            call MPI_FILE_OPEN(nall,'checkpoints/a1_e1.break',
>     !     +           MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL,
>     !     +           fh,ierr)
>     !            call MPI_FILE_SET_VIEW(fh,view_disp,
>     !     +           MPI_DOUBLE_PRECISION,fileview_3D,"native",
>     !     +           MPI_INFO_NULL,ierr)
>     !            tmp_old=a1_old(:,2:nyb+1,2:nzb+1)
>     !            call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>     !     +           MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !            view_disp=8*Nx*Ny*Nz
>     !            call MPI_FILE_SET_VIEW(fh,view_disp,
>     !     +           MPI_DOUBLE_PRECISION,fileview_3D,"native",
>     !     +           MPI_INFO_NULL,ierr)
>     !            tmp_old=b1_old(:,2:nyb+1,2:nzb+1)
>     !            call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>     !     +           MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !            view_disp=2*8*Nx*Ny*Nz
>     !            call MPI_FILE_SET_VIEW(fh,view_disp,
>     !     +           MPI_DOUBLE_PRECISION,fileview_3D,"native",
>     !     +           MPI_INFO_NULL,ierr)
>     !            tmp_old=c1_old(:,2:nyb+1,2:nzb+1)
>     !            call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>     !     +           MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !            view_disp=3*8*Nx*Ny*Nz
>     !            call MPI_FILE_SET_VIEW(fh,view_disp,
>     !     +           MPI_DOUBLE_PRECISION,fileview_3D,"native",
>     !     +           MPI_INFO_NULL,ierr)
>     !            tmp_old=d1_old(:,2:nyb+1,2:nzb+1)
>     !            call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>     !     +           MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !            view_disp=4*8*Nx*Ny*Nz
>     !            call MPI_FILE_SET_VIEW(fh,view_disp,
>     !     +           MPI_DOUBLE_PRECISION,fileview_3D,"native",
>     !     +           MPI_INFO_NULL,ierr)
>     !            tmp_old=e1_old(:,2:nyb+1,2:nzb+1)
>     !            call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>     !     +           MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !            call MPI_FILE_CLOSE(fh,ierr)
>     !            view_disp=0
> 
>     !            call MPI_FILE_OPEN(nall,'checkpoints/a2_e2.break',
>     !     +           MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL,
>     !     +           fh,ierr)
>     !            call MPI_FILE_SET_VIEW(fh,view_disp,
>     !     +           MPI_DOUBLE_PRECISION,fileview_3D,"native",
>     !     +           MPI_INFO_NULL,ierr)
>     !            tmp_old=a2_old(:,2:nyb+1,2:nzb+1)
>     !            call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>     !     +           MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !            view_disp=8*Nx*Ny*Nz
>     !            call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>     !     +           fileview_3D,"native",MPI_INFO_NULL,ierr)
>     !            tmp_old=b2_old(:,2:nyb+1,2:nzb+1)
>     !            call MPI_FILE_WRITE_ALL(fh,b2_old(1,2,2),Nx*Nyb*Nzb,
>     !     +           MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !            view_disp=2*8*Nx*Ny*Nz
>     !            call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>     !     +           fileview_3D,"native",MPI_INFO_NULL,ierr)
>     !            tmp_old=c2_old(:,2:nyb+1,2:nzb+1)
>     !            call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>     !     +           MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !            view_disp=3*8*Nx*Ny*Nz
>     !            call MPI_FILE_SET_VIEW(fh,view_disp,
>     !     +           MPI_DOUBLE_PRECISION,fileview_3D,"native",
>     !     +           MPI_INFO_NULL,ierr)
>     !            tmp_old=d2_old(:,2:nyb+1,2:nzb+1)
>     !            call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>     !     +           MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !            view_disp=4*8*Nx*Ny*Nz
>     !            call MPI_FILE_SET_VIEW(fh,view_disp,MPI_DOUBLE_PRECISION,
>     !     +           fileview_3D,"native",MPI_INFO_NULL,ierr)
>     !            tmp_old=e2_old(:,2:nyb+1,2:nzb+1)
>     !            call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>     !     +           MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>     !            call MPI_FILE_CLOSE(fh,ierr)
>     !            view_disp=0
2636c2951
<                            
---
> 
2648,2652d2962
<                 call MPI_FILE_OPEN(nall,filestr2,MPI_MODE_WRONLY+ &
<                 MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
2654,2659c2964,2968
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,fileStr21, &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2661,2662c2970,2973
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>                 call MPI_FILE_OPEN(nall,fileStr22, &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
2664c2975,2992
<                 view_disp=0
---
> 
>             !                  call MPI_FILE_OPEN(nall,filestr2,MPI_MODE_WRONLY+
>             !     +                 MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
>             !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>             !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>             !     +                 MPI_INFO_NULL,ierr)
>             !                  tmp_old=a4_old(:,2:nyb+1,2:nzb+1,l)
>             !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>             !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             !                  view_disp=8*Nx*Ny*Nz
>             !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>             !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>             !     +                 MPI_INFO_NULL,ierr)
>             !                  tmp_old=b4_old(:,2:nyb+1,2:nzb+1,l)
>             !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>             !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             !                  call MPI_FILE_CLOSE(fh,ierr)
>             !                  view_disp=0
2668,2673c2996,2997
<                               
<                 call MPI_FILE_OPEN(nall,filestr2,MPI_MODE_WRONLY+ &
<                 MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
> 
> 
2675,2680c2999,3003
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,fileStr21, &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2682,2687c3005,3009
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=2*8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,fileStr22, &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2689,2694c3011,3015
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=3*8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,fileStr23, &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2696,2701c3017,3021
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=4*8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,fileStr24, &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2703,2704c3023,3026
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>                 call MPI_FILE_OPEN(nall,fileStr25, &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
2707,2712d3028
< 
<                 call MPI_FILE_OPEN(nall,filestr3,MPI_MODE_WRONLY+ &
<                 MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
2714,2719c3030,3034
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,fileStr31, &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2721,2726c3036,3040
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=2*8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,fileStr32, &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2728,2733c3042,3046
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=3*8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,fileStr33, &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2735,2740c3048,3052
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
<                 view_disp=4*8*Nx*Ny*Nz
<                 call MPI_FILE_SET_VIEW(fh,view_disp, &
<                 MPI_DOUBLE_PRECISION,fileview_3D,"native", &
<                 MPI_INFO_NULL,ierr)
---
>                 call MPI_FILE_OPEN(nall,fileStr34, &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
>                 call MPI_FILE_CLOSE(fh,ierr)
2742,2743c3054,3057
<                 call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb, &
<                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
---
>                 call MPI_FILE_OPEN(nall,fileStr35, &
>                 MPI_MODE_WRONLY+MPI_MODE_CREATE,MPI_INFO_NULL, &
>                 fh,ierr)
>                 call write3D(fh,tmp_old,1,1,2,fileview_3D,view_disp)
2745c3059,3137
<                 view_disp=0
---
> 
> 
>             !                  call MPI_FILE_OPEN(nall,filestr2,MPI_MODE_WRONLY+
>             !     +                 MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
>             !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>             !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>             !     +                 MPI_INFO_NULL,ierr)
>             !                  tmp_old=a4_old(:,2:nyb+1,2:nzb+1,l)
>             !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>             !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             !                  view_disp=8*Nx*Ny*Nz
>             !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>             !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>             !     +                 MPI_INFO_NULL,ierr)
>             !                  tmp_old=b4_old(:,2:nyb+1,2:nzb+1,l)
>             !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>             !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             !                  view_disp=2*8*Nx*Ny*Nz
>             !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>             !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>             !     +                 MPI_INFO_NULL,ierr)
>             !                  tmp_old=c4_old(:,2:nyb+1,2:nzb+1,l)
>             !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>             !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             !                  view_disp=3*8*Nx*Ny*Nz
>             !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>             !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>             !     +                 MPI_INFO_NULL,ierr)
>             !                  tmp_old=d4_old(:,2:nyb+1,2:nzb+1,l)
>             !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>             !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             !                  view_disp=4*8*Nx*Ny*Nz
>             !                 call MPI_FILE_SET_VIEW(fh,view_disp,
>             !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>             !     +                 MPI_INFO_NULL,ierr)
>             !                  tmp_old=e4_old(:,2:nyb+1,2:nzb+1,l)
>             !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>             !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             !                  call MPI_FILE_CLOSE(fh,ierr)
>             !                  view_disp=0
> 
>             !                  call MPI_FILE_OPEN(nall,filestr3,MPI_MODE_WRONLY+
>             !     +                 MPI_MODE_CREATE,MPI_INFO_NULL,fh,ierr)
>             !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>             !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>             !     +                 MPI_INFO_NULL,ierr)
>             !                  tmp_old=a8_old(:,2:nyb+1,2:nzb+1,l)
>             !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>             !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             !                  view_disp=8*Nx*Ny*Nz
>             !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>             !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>             !     +                 MPI_INFO_NULL,ierr)
>             !                  tmp_old=b8_old(:,2:nyb+1,2:nzb+1,l)
>             !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>             !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             !                  view_disp=2*8*Nx*Ny*Nz
>             !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>             !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>             !     +                 MPI_INFO_NULL,ierr)
>             !                  tmp_old=c8_old(:,2:nyb+1,2:nzb+1,l)
>             !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>             !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             !                  view_disp=3*8*Nx*Ny*Nz
>             !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>             !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>             !     +                 MPI_INFO_NULL,ierr)
>             !                  tmp_old=d8_old(:,2:nyb+1,2:nzb+1,l)
>             !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>             !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             !                  view_disp=4*8*Nx*Ny*Nz
>             !                  call MPI_FILE_SET_VIEW(fh,view_disp,
>             !     +                 MPI_DOUBLE_PRECISION,fileview_3D,"native",
>             !     +                 MPI_INFO_NULL,ierr)
>             !                  tmp_old=e8_old(:,2:nyb+1,2:nzb+1,l)
>             !                  call MPI_FILE_WRITE_ALL(fh,tmp_old,Nx*Nyb*Nzb,
>             !     +                 MPI_DOUBLE_PRECISION,MPI_STATUS_IGNORE,ierr)
>             !                  call MPI_FILE_CLOSE(fh,ierr)
>             !                  view_disp=0
2750c3142
<                         
---
> 
2776c3168
<                         
---
> 
2787c3179
<                                
---
> 
2798c3190
<                       
---
> 
2809c3201
<     call MPI_FINALIZE(ierr)
---
>     999 call MPI_FINALIZE(ierr)
